<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUBG Elite Montage Editor</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FFmpeg.wasm Core -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            background: #06b6d4;
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
        }
        .preset-btn {
            @apply py-3 px-2 bg-gray-800/50 border border-white/5 rounded-xl text-[11px] font-bold uppercase hover:bg-cyan-500/20 hover:border-cyan-500/50 transition-all active:scale-95;
        }
    </style>
</head>
<body class="bg-[#0a0a0c] text-white min-h-screen font-sans selection:bg-cyan-500 selection:text-black">

    <div class="container mx-auto px-4 py-10 flex flex-col items-center">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 via-orange-500 to-red-600 drop-shadow-[0_0_15px_rgba(234,179,8,0.3)]">
                PUBG MOBILE ENHANCER
            </h1>
            <p class="text-cyan-400 font-mono tracking-[0.3em] mt-2 uppercase text-sm">Multimedia Engineering Protocol v1.1</p>
        </div>

        <!-- Editor Interface -->
        <div class="w-full max-w-4xl bg-[#121216] border border-white/10 rounded-3xl p-6 md:p-10 shadow-2xl relative overflow-hidden">
            <!-- Decorative Glow -->
            <div class="absolute -top-24 -left-24 w-48 h-48 bg-cyan-500/10 blur-[100px] rounded-full"></div>
            <div class="absolute -bottom-24 -right-24 w-48 h-48 bg-red-500/10 blur-[100px] rounded-full"></div>

            <!-- Upload Area -->
            <div id="dropZone" class="relative group cursor-pointer border-2 border-dashed border-gray-700 hover:border-cyan-500/50 rounded-2xl p-8 text-center transition-all bg-black/20 mb-8 active:scale-[0.98]">
                <input type="file" id="videoInput" accept="video/*" class="hidden">
                <div id="uploadUI" class="space-y-4">
                    <div class="mx-auto w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-cyan-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                    </div>
                    <p id="fileName" class="text-gray-400 font-medium italic text-lg">اضغط هنا لاختيار فيديو الببجي</p>
                    <p class="text-gray-600 text-xs">يدعم MP4, MOV, MKV</p>
                </div>
                <video id="miniPreview" class="hidden mx-auto h-40 rounded-lg border border-cyan-500/50 mt-2 shadow-lg" muted autoplay loop playsinline></video>
            </div>

            <!-- Quick Presets -->
            <div class="mb-10">
                <h3 class="text-[10px] uppercase tracking-[0.3em] text-gray-500 font-bold mb-4 text-center">Ready Presets / قوالب جاهزة</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button onclick="applyPreset('vibrant')" class="preset-btn hover:text-yellow-400">Vibrant Erangel</button>
                    <button onclick="applyPreset('sharp')" class="preset-btn hover:text-cyan-400">Ultra Sharp</button>
                    <button onclick="applyPreset('cinematic')" class="preset-btn hover:text-purple-400">Cinematic Night</button>
                    <button onclick="applyPreset('original')" class="preset-btn hover:text-red-400">Reset Original</button>
                </div>
            </div>

            <!-- Controls -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-10">
                <div class="space-y-3">
                    <div class="flex justify-between text-[10px] uppercase tracking-widest text-gray-500 font-bold">
                        <span>Sharpness</span>
                        <span id="sharpVal" class="text-cyan-400">1.5</span>
                    </div>
                    <input type="range" id="sharpness" min="0" max="3" step="0.1" value="1.5" class="w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between text-[10px] uppercase tracking-widest text-gray-500 font-bold">
                        <span>Saturation</span>
                        <span id="satVal" class="text-yellow-500">1.5</span>
                    </div>
                    <input type="range" id="saturation" min="0" max="3" step="0.1" value="1.5" class="w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="space-y-3">
                    <div class="flex justify-between text-[10px] uppercase tracking-widest text-gray-500 font-bold">
                        <span>Brightness</span>
                        <span id="brightVal" class="text-purple-500">0.02</span>
                    </div>
                    <input type="range" id="brightness" min="-0.1" max="0.2" step="0.01" value="0.02" class="w-full h-2 bg-gray-800 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>

            <!-- Execution -->
            <div class="flex flex-col items-center">
                <button id="processBtn" class="w-full md:w-auto px-16 py-5 bg-gradient-to-r from-cyan-600 to-blue-700 rounded-full font-black uppercase tracking-[0.2em] shadow-xl hover:scale-105 active:scale-95 transition-all text-lg border border-white/10">
                    ابدأ التعديل الآن
                </button>

                <!-- Status Panel -->
                <div id="statusContainer" class="hidden w-full mt-8 space-y-3 bg-black/40 p-6 rounded-2xl border border-white/5">
                    <div class="flex justify-between text-[11px] font-mono text-cyan-400">
                        <span id="statusText" class="animate-pulse tracking-widest">PROCESSING VIDEO CORE...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="w-full bg-gray-900 rounded-full h-3 overflow-hidden p-[2px]">
                        <div id="progressBar" class="bg-gradient-to-r from-cyan-500 via-blue-500 to-indigo-600 h-full rounded-full transition-all duration-300 shadow-[0_0_15px_rgba(6,182,212,0.6)]" style="width: 0%"></div>
                    </div>
                </div>

                <!-- Final Output -->
                <div id="resultArea" class="hidden mt-10 w-full space-y-6">
                    <div class="text-center text-green-400 font-bold text-sm uppercase tracking-widest animate-bounce">✨ التعديل جاهز! ✨</div>
                    <video id="previewVideo" controls playsinline class="w-full rounded-xl border border-white/10 shadow-2xl bg-black"></video>
                    <a id="downloadBtn" class="block w-full text-center py-6 bg-gradient-to-r from-green-600 to-emerald-700 text-white rounded-2xl font-black uppercase tracking-widest hover:brightness-110 shadow-xl cursor-pointer text-lg">
                        حفظ المقطع في الاستوديو
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({ log: true });

        const videoInput = document.getElementById('videoInput');
        const dropZone = document.getElementById('dropZone');
        const miniPreview = document.getElementById('miniPreview');
        const uploadUI = document.getElementById('uploadUI');
        const processBtn = document.getElementById('processBtn');
        const statusContainer = document.getElementById('statusContainer');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const resultArea = document.getElementById('resultArea');
        const previewVideo = document.getElementById('previewVideo');
        const downloadBtn = document.getElementById('downloadBtn');

        // UI Logic
        dropZone.onclick = () => videoInput.click();

        videoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                miniPreview.src = url;
                miniPreview.classList.remove('hidden');
                uploadUI.classList.add('hidden');
                document.getElementById('fileName').innerText = "تم اختيار المقطع";
            }
        };

        // Correct ID mapping to avoid InnerText error
        const sliderMap = {
            'sharpness': 'sharpVal',
            'saturation': 'satVal',
            'brightness': 'brightVal'
        };

        Object.keys(sliderMap).forEach(id => {
            const el = document.getElementById(id);
            const valDisplay = document.getElementById(sliderMap[id]);
            if (el && valDisplay) {
                el.oninput = () => {
                    valDisplay.innerText = el.value;
                };
            }
        });

        function applyPreset(type) {
            const s = document.getElementById('sharpness'), 
                  sat = document.getElementById('saturation'), 
                  b = document.getElementById('brightness');
            
            if(type === 'vibrant') { s.value = 1.2; sat.value = 2.0; b.value = 0.04; }
            else if(type === 'sharp') { s.value = 2.5; sat.value = 1.4; b.value = 0.01; }
            else if(type === 'cinematic') { s.value = 1.0; sat.value = 1.6; b.value = -0.05; }
            else { s.value = 1.5; sat.value = 1.5; b.value = 0.02; }
            
            // Trigger the oninput events manually to update text displays
            s.dispatchEvent(new Event('input'));
            sat.dispatchEvent(new Event('input'));
            b.dispatchEvent(new Event('input'));
        }

        // FFmpeg Core Processing
        processBtn.onclick = async () => {
            const file = videoInput.files[0];
            if (!file) {
                alert("يرجى اختيار مقطع فيديو أولاً!");
                return;
            }

            processBtn.disabled = true;
            statusContainer.classList.remove('hidden');
            resultArea.classList.add('hidden');

            try {
                if (!ffmpeg.isLoaded()) {
                    await ffmpeg.load();
                }

                ffmpeg.setProgress(({ ratio }) => {
                    const p = Math.max(0, Math.min(100, Math.round(ratio * 100)));
                    progressBar.style.width = p + '%';
                    progressPercent.innerText = p + '%';
                });

                const inputName = 'input_pubg.mp4';
                const outputName = 'output_pro.mp4';
                
                ffmpeg.FS('writeFile', inputName, await fetchFile(file));

                const sharp = document.getElementById('sharpness').value;
                const sat = document.getElementById('saturation').value;
                const bright = document.getElementById('brightness').value;
                
                // Advanced FFmpeg Chain
                const filter = `unsharp=5:5:${sharp}:5:5:0,eq=saturation=${sat}:brightness=${bright}`;

                await ffmpeg.run('-i', inputName, '-vf', filter, '-c:a', 'copy', outputName);

                const data = ffmpeg.FS('readFile', outputName);
                const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

                previewVideo.src = url;
                downloadBtn.href = url;
                downloadBtn.download = `PUBG_Pro_Edit_${Date.now()}.mp4`;
                
                resultArea.classList.remove('hidden');
                statusContainer.classList.add('hidden');
                processBtn.disabled = false;

            } catch (error) {
                console.error(error);
                alert("حدث خطأ في الذاكرة أو المعالجة. يرجى محاولة استخدام مقطع أصغر حجماً.");
                processBtn.disabled = false;
                statusContainer.classList.add('hidden');
            }
        };
    </script>
</body>
</html>
