<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUBG Elite Montage Editor - Ultra Stable</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FFmpeg.wasm Core -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #22d3ee;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
        }
        .preset-btn {
            @apply py-3 px-2 bg-gray-800/80 border border-white/10 rounded-xl text-[11px] font-bold uppercase hover:bg-cyan-500 hover:text-black transition-all active:scale-95 shadow-lg;
        }
        .glow-text {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
        }
        video::-webkit-media-controls-fullscreen-button {
            display: flex !important;
        }
    </style>
</head>
<body class="bg-[#050507] text-white min-h-screen font-sans selection:bg-cyan-500 selection:text-black">

    <div class="container mx-auto px-4 py-8 flex flex-col items-center">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-6xl md:text-7xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-cyan-400 to-blue-600 glow-text">
                ULTRA PUBG EDITOR
            </h1>
            <p class="text-gray-500 font-mono tracking-[0.4em] mt-2 uppercase text-[10px]">High Performance Rendering Engine v2.0</p>
        </div>

        <!-- Main Editor Card -->
        <div class="w-full max-w-5xl bg-[#0f1115] border-2 border-white/5 rounded-[2.5rem] p-6 md:p-8 shadow-[0_0_50px_rgba(0,0,0,0.5)] relative overflow-hidden">
            
            <!-- Upload / Preview Section -->
            <div id="dropZone" class="relative group cursor-pointer border-2 border-dashed border-gray-800 hover:border-cyan-500/50 rounded-3xl p-6 text-center transition-all bg-black/40 mb-8 min-h-[300px] flex items-center justify-center">
                <input type="file" id="videoInput" accept="video/*" class="hidden">
                
                <div id="uploadUI" class="space-y-6">
                    <div class="mx-auto w-20 h-20 bg-cyan-500/10 rounded-full flex items-center justify-center border border-cyan-500/20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-white mb-2">Ø§Ø®ØªØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-gray-500 text-sm italic">ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù€ 20 Ø«Ø§Ù†ÙŠØ© ÙˆÙ…Ø§ ÙÙˆÙ‚</p>
                    </div>
                </div>

                <div id="previewContainer" class="hidden w-full relative">
                    <video id="miniPreview" class="w-full max-h-[450px] rounded-2xl border border-white/5 shadow-2xl bg-black object-contain" controls playsinline></video>
                    <button onclick="document.getElementById('videoInput').click()" class="absolute -top-3 -right-3 bg-red-600 p-2 rounded-full shadow-xl hover:scale-110 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Presets & Controls -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-1 space-y-3">
                    <p class="text-[10px] font-black text-gray-600 uppercase tracking-widest mb-4">Color Presets</p>
                    <button onclick="applyPreset('vibrant')" class="preset-btn w-full">Vibrant Erangel</button>
                    <button onclick="applyPreset('sharp')" class="preset-btn w-full">Ultra Sharp</button>
                    <button onclick="applyPreset('cinematic')" class="preset-btn w-full">Cinematic Night</button>
                    <button onclick="applyPreset('original')" class="preset-btn w-full">Reset</button>
                </div>

                <div class="lg:col-span-3 bg-black/20 p-6 rounded-3xl border border-white/5 space-y-8">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-cyan-400 uppercase tracking-tighter">Sharpness / Ø§Ù„Ø­Ø¯Ø©</label>
                            <span id="sharpVal" class="bg-cyan-500/20 text-cyan-400 px-3 py-1 rounded-md text-xs font-mono">1.5</span>
                        </div>
                        <input type="range" id="sharpness" min="0" max="3" step="0.1" value="1.5" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-yellow-500 uppercase tracking-tighter">Saturation / Ø§Ù„Ø£Ù„ÙˆØ§Ù†</label>
                            <span id="satVal" class="bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-md text-xs font-mono">1.5</span>
                        </div>
                        <input type="range" id="saturation" min="0" max="3" step="0.1" value="1.5" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-purple-500 uppercase tracking-tighter">Brightness / Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©</label>
                            <span id="brightVal" class="bg-purple-500/20 text-purple-500 px-3 py-1 rounded-md text-xs font-mono">1.0</span>
                        </div>
                        <input type="range" id="brightness" min="0.5" max="1.5" step="0.01" value="1.0" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>
                </div>
            </div>

            <!-- Action Area -->
            <div class="mt-10">
                <button id="processBtn" class="w-full py-6 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl font-black text-xl uppercase tracking-widest hover:scale-[1.01] active:scale-95 transition-all shadow-[0_10px_30px_rgba(6,182,212,0.3)]">
                    Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ÙˆÙŠØ© âš¡
                </button>

                <!-- Status -->
                <div id="statusContainer" class="hidden mt-8 p-6 bg-black rounded-3xl border border-cyan-500/20">
                    <div class="flex justify-between mb-4">
                        <span id="statusText" class="text-cyan-400 font-bold text-xs animate-pulse">SYSTEM PROCESSING...</span>
                        <span id="progressPercent" class="text-cyan-400 font-mono text-xs">0%</span>
                    </div>
                    <div class="w-full bg-gray-900 h-4 rounded-full overflow-hidden">
                        <div id="progressBar" class="h-full bg-cyan-500 transition-all duration-300 shadow-[0_0_20px_rgba(6,182,212,0.8)]" style="width: 0%"></div>
                    </div>
                    <p class="text-gray-600 text-[10px] mt-4 text-center">Ù„Ø§ ØªØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ‚ÙˆÙ… Ø¨Ø¶ØºØ· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø­ÙØ¸</p>
                </div>

                <!-- Result -->
                <div id="resultArea" class="hidden mt-10 space-y-6">
                    <div class="bg-green-500/10 border border-green-500/20 p-4 rounded-2xl text-center text-green-400 font-bold text-sm">
                        Ù…Ø¨Ø§Ø±Ùƒ! ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø¨Ø£Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ù…Ù…ÙƒÙ†
                    </div>
                    <video id="previewVideo" controls playsinline class="w-full rounded-2xl border border-white/10 bg-black shadow-2xl"></video>
                    <button id="realDownloadBtn" class="w-full py-6 bg-white text-black rounded-2xl font-black text-xl uppercase tracking-widest hover:bg-gray-200 shadow-2xl transition-colors">
                        Ø­ÙØ¸ Ø§Ù„Ù…Ù‚Ø·Ø¹ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ ğŸ’¾
                    </button>
                </div>
            </div>
        </div>
        
        <p class="mt-8 text-gray-700 text-[10px] uppercase font-bold tracking-[0.5em]">Developed for Mobile Competitive Scene</p>
    </div>

    <script>
        const { createFFmpeg, fetchFile } = FFmpeg;
        // Optimization: High Performance Memory Settings
        const ffmpeg = createFFmpeg({ log: false });

        const videoInput = document.getElementById('videoInput');
        const miniPreview = document.getElementById('miniPreview');
        const previewContainer = document.getElementById('previewContainer');
        const uploadUI = document.getElementById('uploadUI');
        const processBtn = document.getElementById('processBtn');
        const statusContainer = document.getElementById('statusContainer');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');
        const resultArea = document.getElementById('resultArea');
        const previewVideo = document.getElementById('previewVideo');
        const realDownloadBtn = document.getElementById('realDownloadBtn');

        let lastBlobUrl = null;

        document.getElementById('dropZone').onclick = (e) => {
            if (e.target.tagName !== 'VIDEO' && e.target.tagName !== 'BUTTON') videoInput.click();
        };

        videoInput.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                miniPreview.src = url;
                previewContainer.classList.remove('hidden');
                uploadUI.classList.add('hidden');
                updateFilters();
            }
        };

        function updateFilters() {
            const s = document.getElementById('sharpness').value;
            const sat = document.getElementById('saturation').value;
            const b = document.getElementById('brightness').value;
            miniPreview.style.filter = `saturate(${sat}) brightness(${b}) contrast(${1 + (s*0.2)})`;
        }

        ['sharpness', 'saturation', 'brightness'].forEach(id => {
            document.getElementById(id).oninput = (e) => {
                document.getElementById(id + 'Val').innerText = e.target.value;
                updateFilters();
            };
        });

        function applyPreset(type) {
            const s = document.getElementById('sharpness'), sat = document.getElementById('saturation'), b = document.getElementById('brightness');
            if(type === 'vibrant') { s.value = 1.2; sat.value = 2.0; b.value = 1.1; }
            else if(type === 'sharp') { s.value = 2.5; sat.value = 1.4; b.value = 1.0; }
            else if(type === 'cinematic') { s.value = 1.0; sat.value = 1.6; b.value = 0.9; }
            else { s.value = 1.5; sat.value = 1.5; b.value = 1.0; }
            [s, sat, b].forEach(el => el.dispatchEvent(new Event('input')));
        }

        processBtn.onclick = async () => {
            const file = videoInput.files[0];
            if (!file) return;

            processBtn.disabled = true;
            statusContainer.classList.remove('hidden');
            resultArea.classList.add('hidden');
            
            try {
                if (!ffmpeg.isLoaded()) await ffmpeg.load();

                ffmpeg.setProgress(({ ratio }) => {
                    const p = Math.max(0, Math.min(100, Math.round(ratio * 100)));
                    progressBar.style.width = p + '%';
                    progressPercent.innerText = p + '%';
                });

                const inputName = 'in.mp4';
                const outputName = 'out.mp4';
                ffmpeg.FS('writeFile', inputName, await fetchFile(file));

                const sharp = document.getElementById('sharpness').value;
                const sat = document.getElementById('saturation').value;
                const br = (parseFloat(document.getElementById('brightness').value) - 1.0);
                
                // ULTRA STABLE FILTER:
                // -crf 30: Strong compression to ensure the file size stays small enough for RAM.
                // -b:v 2M: Limit bitrate to 2Mbps for mobile stability.
                // -vcodec libx264: Universal compatibility.
                const filter = `scale=-1:720,unsharp=5:5:${sharp}:5:5:0,eq=saturation=${sat}:brightness=${br}`;

                await ffmpeg.run(
                    '-i', inputName,
                    '-vf', filter,
                    '-c:v', 'libx264',
                    '-crf', '30', 
                    '-b:v', '2M',
                    '-preset', 'ultrafast',
                    '-c:a', 'copy',
                    outputName
                );

                const data = ffmpeg.FS('readFile', outputName);
                const blob = new Blob([data.buffer], { type: 'video/mp4' });
                
                if (lastBlobUrl) URL.revokeObjectURL(lastBlobUrl);
                lastBlobUrl = URL.createObjectURL(blob);

                previewVideo.src = lastBlobUrl;
                resultArea.classList.remove('hidden');
                statusContainer.classList.add('hidden');
                processBtn.disabled = false;

                ffmpeg.FS('unlink', inputName);
                ffmpeg.FS('unlink', outputName);

            } catch (err) {
                console.error(err);
                alert("ØªØ¹Ø°Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©. Ø­Ø§ÙˆÙ„ ØªÙ‚ØµÙŠØ± Ø§Ù„Ù…Ù‚Ø·Ø¹ Ø£Ùˆ Ø¥ØºÙ„Ø§Ù‚ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ©.");
                processBtn.disabled = false;
            }
        };

        realDownloadBtn.onclick = () => {
            if (!lastBlobUrl) return;
            
            // The Absolute Force Download Method
            const a = document.createElement('a');
            a.href = lastBlobUrl;
            a.download = `PUBG_ULTRA_EDIT.mp4`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);

            // Immediate instructions
            setTimeout(() => {
                alert("Ø¨Ø¯Ø£ Ø§Ù„Ø­ÙØ¸! Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆØŒ Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ§Ø®ØªØ± 'Ø­ÙØ¸ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ'.");
            }, 500);
        };
    </script>
</body>
</html>
