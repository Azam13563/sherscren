<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PUBG Elite Montage Editor - Ultra Stable</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FFmpeg.wasm Core -->
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <style>
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #22d3ee;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
        }
        .preset-btn {
            @apply py-3 px-2 bg-gray-800/80 border border-white/10 rounded-xl text-[11px] font-bold uppercase hover:bg-cyan-500 hover:text-black transition-all active:scale-95 shadow-lg;
        }
        .glow-text {
            text-shadow: 0 0 10px rgba(34, 211, 238, 0.5);
        }
        video::-webkit-media-controls-fullscreen-button {
            display: flex !important;
        }
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø³ */
        .btn-download {
            @apply w-full py-4 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl font-black text-sm uppercase tracking-widest hover:scale-[1.01] active:scale-95 transition-all shadow-[0_10px_30px_rgba(6,182,212,0.3)] disabled:opacity-50 disabled:cursor-not-allowed;
        }
    </style>
</head>
<body class="bg-[#050507] text-white min-h-screen font-sans selection:bg-cyan-500 selection:text-black">

    <div class="container mx-auto px-4 py-8 flex flex-col items-center">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl md:text-7xl font-black italic tracking-tighter text-transparent bg-clip-text bg-gradient-to-b from-cyan-400 to-blue-600 glow-text">
                ULTRA PUBG EDITOR
            </h1>
            <p class="text-gray-500 font-mono tracking-[0.4em] mt-2 uppercase text-[10px]">High Performance Rendering Engine v3.0</p>
        </div>

        <!-- Main Editor Card -->
        <div class="w-full max-w-5xl bg-[#0f1115] border-2 border-white/5 rounded-[2.5rem] p-6 md:p-8 shadow-[0_0_50px_rgba(0,0,0,0.5)] relative overflow-hidden">
            
            <!-- Upload / Preview Section -->
            <div id="dropZone" class="relative group cursor-pointer border-2 border-dashed border-gray-800 hover:border-cyan-500/50 rounded-3xl p-6 text-center transition-all bg-black/40 mb-8 min-h-[300px] flex items-center justify-center">
                <input type="file" id="videoInput" accept="video/*" class="hidden">
                
                <div id="uploadUI" class="space-y-6">
                    <div class="mx-auto w-20 h-20 bg-cyan-500/10 rounded-full flex items-center justify-center border border-cyan-500/20">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                    </div>
                    <div>
                        <p class="text-2xl font-bold text-white mb-2">Ø§Ø®ØªØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-gray-500 text-sm italic">ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†Ø¸Ø§Ù… Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù…Ù‚Ø§Ø·Ø¹ Ø§Ù„Ù€ 20 Ø«Ø§Ù†ÙŠØ© ÙˆÙ…Ø§ ÙÙˆÙ‚</p>
                    </div>
                </div>

                <div id="previewContainer" class="hidden w-full relative">
                    <video id="miniPreview" class="w-full max-h-[450px] rounded-2xl border border-white/5 shadow-2xl bg-black object-contain" controls playsinline></video>
                    <button onclick="document.getElementById('videoInput').click()" class="absolute -top-3 -right-3 bg-red-600 p-2 rounded-full shadow-xl hover:scale-110 transition-transform">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Presets & Controls -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                <div class="lg:col-span-1 space-y-3">
                    <p class="text-[10px] font-black text-gray-600 uppercase tracking-widest mb-4">Color Presets</p>
                    <button onclick="applyPreset('vibrant')" class="preset-btn w-full">Vibrant Erangel</button>
                    <button onclick="applyPreset('sharp')" class="preset-btn w-full">Ultra Sharp</button>
                    <button onclick="applyPreset('cinematic')" class="preset-btn w-full">Cinematic Night</button>
                    <button onclick="applyPreset('original')" class="preset-btn w-full">Reset</button>
                </div>

                <div class="lg:col-span-3 bg-black/20 p-6 rounded-3xl border border-white/5 space-y-8">
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-cyan-400 uppercase tracking-tighter">Sharpness / Ø§Ù„Ø­Ø¯Ø©</label>
                            <span id="sharpVal" class="bg-cyan-500/20 text-cyan-400 px-3 py-1 rounded-md text-xs font-mono">1.5</span>
                        </div>
                        <input type="range" id="sharpness" min="0" max="3" step="0.1" value="1.5" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-yellow-500 uppercase tracking-tighter">Saturation / Ø§Ù„Ø£Ù„ÙˆØ§Ù†</label>
                            <span id="satVal" class="bg-yellow-500/20 text-yellow-500 px-3 py-1 rounded-md text-xs font-mono">1.5</span>
                        </div>
                        <input type="range" id="saturation" min="0" max="3" step="0.1" value="1.5" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>

                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <label class="text-sm font-bold text-purple-500 uppercase tracking-tighter">Brightness / Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø©</label>
                            <span id="brightVal" class="bg-purple-500/20 text-purple-500 px-3 py-1 rounded-md text-xs font-mono">1.0</span>
                        </div>
                        <input type="range" id="brightness" min="0.5" max="1.5" step="0.01" value="1.0" class="w-full h-1.5 bg-gray-800 rounded-lg appearance-none">
                    </div>
                </div>
            </div>

            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø­ÙØ¸ -->
            <div class="mt-6 p-4 bg-black/40 rounded-2xl border border-white/5">
                <p class="text-[10px] font-black text-gray-600 uppercase tracking-widest mb-3">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¶ØºØ· (Ù„Ù„Ø­ÙØ¸)</p>
                <div class="flex gap-3 flex-wrap">
                    <label class="flex items-center gap-2 text-xs">
                        <input type="radio" name="quality" value="high" checked> Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© (Ù‚Ø¯ Ù„Ø§ ÙŠØ­ÙØ¸)
                    </label>
                    <label class="flex items-center gap-2 text-xs">
                        <input type="radio" name="quality" value="medium"> ÙˆØ³Ø· (480p)
                    </label>
                    <label class="flex items-center gap-2 text-xs">
                        <input type="radio" name="quality" value="low"> Ù…Ù†Ø®ÙØ¶ (360p) - Ø£Ù†Ø¬Ø­
                    </label>
                </div>
                <p class="text-[10px] text-gray-500 mt-2">Ø§Ø®ØªØ± Ù…Ù†Ø®ÙØ¶Ø§Ù‹ Ø¥Ø°Ø§ ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø­ÙØ¸.</p>
            </div>

            <!-- Action Area -->
            <div class="mt-8 space-y-4">
                <button id="processBtn" class="w-full py-6 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-2xl font-black text-xl uppercase tracking-widest hover:scale-[1.01] active:scale-95 transition-all shadow-[0_10px_30px_rgba(6,182,212,0.3)]">
                    Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù‚ÙˆÙŠØ© âš¡
                </button>

                <!-- Status -->
                <div id="statusContainer" class="hidden mt-8 p-6 bg-black rounded-3xl border border-cyan-500/20">
                    <div class="flex justify-between mb-4">
                        <span id="statusText" class="text-cyan-400 font-bold text-xs animate-pulse">SYSTEM PROCESSING...</span>
                        <span id="progressPercent" class="text-cyan-400 font-mono text-xs">0%</span>
                    </div>
                    <div class="w-full bg-gray-900 h-4 rounded-full overflow-hidden">
                        <div id="progressBar" class="h-full bg-cyan-500 transition-all duration-300 shadow-[0_0_20px_rgba(6,182,212,0.8)]" style="width: 0%"></div>
                    </div>
                    <p class="text-gray-600 text-[10px] mt-4 text-center">Ù„Ø§ ØªØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ‚ÙˆÙ… Ø¨Ø¶ØºØ· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                </div>

                <!-- Result -->
                <div id="resultArea" class="hidden mt-10 space-y-6">
                    <div class="bg-green-500/10 border border-green-500/20 p-4 rounded-2xl text-center text-green-400 font-bold text-sm">
                        âœ… ØªÙ… Ø§Ù„ØªØ¬Ù‡ÙŠØ²! Ø§Ø¶ØºØ· Ø­ÙØ¸
                    </div>
                    <video id="previewVideo" controls playsinline class="w-full rounded-2xl border border-white/10 bg-black shadow-2xl"></video>
                    
                    <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù -->
                    <div id="fileSizeInfo" class="text-xs text-gray-400 text-center"></div>

                    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­ÙØ¸ -->
                    <div class="grid grid-cols-2 gap-3">
                        <button id="realDownloadBtn" class="btn-download col-span-1">
                            Ø­ÙØ¸ Ø¹Ø§Ø¯ÙŠ ğŸ’¾
                        </button>
                        <button id="emergencyDownloadBtn" class="btn-download bg-orange-600 col-span-1">
                            Ø­ÙØ¸ Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ø¬ÙˆØ¯Ø© ğŸ†˜
                        </button>
                    </div>
                    <p class="text-[10px] text-gray-600 text-center">Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ø¯ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø± Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ø¶ØºØ· Ø¥Ø¶Ø§ÙÙŠ.</p>
                </div>
            </div>
        </div>
        
        <p class="mt-8 text-gray-700 text-[10px] uppercase font-bold tracking-[0.5em]">Developed for Mobile Competitive Scene</p>
    </div>

    <script>
        (function() {
            // ØªØ³Ø±ÙŠØ¹ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            const { createFFmpeg, fetchFile } = FFmpeg;
            // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª FFmpeg Ù…Ø¹ Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ù„Ø°Ø§ÙƒØ±Ø© (Ù…Ø­Ø§ÙˆÙ„Ø©)
            const ffmpeg = createFFmpeg({ 
                log: false,
                corePath: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js',
                mainName: 'main',
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ ÙÙŠ ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
            });

            // Ø¹Ù†Ø§ØµØ± DOM
            const videoInput = document.getElementById('videoInput');
            const miniPreview = document.getElementById('miniPreview');
            const previewContainer = document.getElementById('previewContainer');
            const uploadUI = document.getElementById('uploadUI');
            const processBtn = document.getElementById('processBtn');
            const statusContainer = document.getElementById('statusContainer');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            const resultArea = document.getElementById('resultArea');
            const previewVideo = document.getElementById('previewVideo');
            const realDownloadBtn = document.getElementById('realDownloadBtn');
            const emergencyDownloadBtn = document.getElementById('emergencyDownloadBtn');
            const fileSizeInfo = document.getElementById('fileSizeInfo');
            
            // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
            let lastBlobUrl = null;
            let lastProcessedBlob = null; // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„ blob Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ø§Ø±Ø¦Ø©

            // Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            document.getElementById('dropZone').onclick = (e) => {
                if (e.target.tagName !== 'VIDEO' && e.target.tagName !== 'BUTTON') videoInput.click();
            };

            videoInput.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    miniPreview.src = url;
                    previewContainer.classList.remove('hidden');
                    uploadUI.classList.add('hidden');
                    updateFilters();
                }
            };

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ„Ø§ØªØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            function updateFilters() {
                const s = document.getElementById('sharpness').value;
                const sat = document.getElementById('saturation').value;
                const b = document.getElementById('brightness').value;
                miniPreview.style.filter = `saturate(${sat}) brightness(${b}) contrast(${1 + (s*0.2)})`;
            }

            ['sharpness', 'saturation', 'brightness'].forEach(id => {
                document.getElementById(id).oninput = (e) => {
                    document.getElementById(id + 'Val').innerText = e.target.value;
                    updateFilters();
                };
            });

            // Ø¨Ø±ÙŠØ³ÙŠØªØ§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            window.applyPreset = function(type) {
                const s = document.getElementById('sharpness'), sat = document.getElementById('saturation'), b = document.getElementById('brightness');
                if(type === 'vibrant') { s.value = 1.2; sat.value = 2.0; b.value = 1.1; }
                else if(type === 'sharp') { s.value = 2.5; sat.value = 1.4; b.value = 1.0; }
                else if(type === 'cinematic') { s.value = 1.0; sat.value = 1.6; b.value = 0.9; }
                else { s.value = 1.5; sat.value = 1.5; b.value = 1.0; }
                [s, sat, b].forEach(el => el.dispatchEvent(new Event('input')));
            };

            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            processBtn.onclick = async () => {
                const file = videoInput.files[0];
                if (!file) return;

                // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                processBtn.disabled = true;
                statusContainer.classList.remove('hidden');
                resultArea.classList.add('hidden');
                progressBar.style.width = '0%';
                progressPercent.innerText = '0%';

                try {
                    // ØªØ­Ù…ÙŠÙ„ ffmpeg Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…Ø­Ù…Ù„Ø§Ù‹
                    if (!ffmpeg.isLoaded()) {
                        await ffmpeg.load();
                    }

                    // Ø¥Ø¹Ø¯Ø§Ø¯ progress
                    ffmpeg.setProgress(({ ratio }) => {
                        const p = Math.max(0, Math.min(100, Math.round(ratio * 100)));
                        progressBar.style.width = p + '%';
                        progressPercent.innerText = p + '%';
                    });

                    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù
                    const inputName = 'in.mp4';
                    const outputName = 'out.mp4';
                    ffmpeg.FS('writeFile', inputName, await fetchFile(file));

                    // Ù‚ÙŠÙ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    const sharp = parseFloat(document.getElementById('sharpness').value);
                    const sat = parseFloat(document.getElementById('saturation').value);
                    const br = parseFloat(document.getElementById('brightness').value) - 1.0; // ffmpeg eq brightness ÙØ±Ù‚ -1..1
                    
                    // ØªØ­Ø¯ÙŠØ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ù…Ø®ØªØ§Ø±
                    const quality = document.querySelector('input[name="quality"]:checked').value;
                    let scale, crf, bitrate;
                    if (quality === 'high') {
                        scale = '720'; // Ø¹Ø±Ø¶ 720
                        crf = '32';
                        bitrate = '1.5M';
                    } else if (quality === 'medium') {
                        scale = '480';
                        crf = '35';
                        bitrate = '1M';
                    } else {
                        scale = '360';
                        crf = '38';
                        bitrate = '800k';
                    }

                    // ÙÙ„ØªØ± Ù‚ÙˆÙŠ Ø¬Ø¯Ø§Ù‹ Ù…Ø¹ ØªØµØºÙŠØ± Ø§Ù„Ø¯Ù‚Ø©
                    const filter = `scale=-2:${scale},unsharp=5:5:${sharp}:5:5:0,eq=saturation=${sat}:brightness=${br}`;

                    // Ø£ÙˆØ§Ù…Ø± ffmpeg Ù…Ø¶ØºÙˆØ·Ø© Ø¬Ø¯Ø§Ù‹
                    await ffmpeg.run(
                        '-i', inputName,
                        '-vf', filter,
                        '-c:v', 'libx264',
                        '-crf', crf,
                        '-b:v', bitrate,
                        '-preset', 'ultrafast',
                        '-movflags', '+faststart', // Ù„Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
                        '-c:a', 'copy', // Ù†Ø³Ø® Ø§Ù„ØµÙˆØª Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±
                        outputName
                    );

                    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø©
                    const data = ffmpeg.FS('readFile', outputName);
                    const blob = new Blob([data.buffer], { type: 'video/mp4' });
                    
                    // ØªÙ†Ø¸ÙŠÙ Ù…Ù„ÙØ§Øª FFmpeg
                    try { ffmpeg.FS('unlink', inputName); } catch(e) {}
                    try { ffmpeg.FS('unlink', outputName); } catch(e) {}

                    // ØªØ®Ø²ÙŠÙ† blob
                    if (lastBlobUrl) URL.revokeObjectURL(lastBlobUrl);
                    lastBlobUrl = URL.createObjectURL(blob);
                    lastProcessedBlob = blob;

                    // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
                    previewVideo.src = lastBlobUrl;
                    
                    // Ø¹Ø±Ø¶ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
                    const sizeMB = (blob.size / (1024 * 1024)).toFixed(2);
                    fileSizeInfo.innerText = `Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: ${sizeMB} MB`;
                    if (blob.size > 100 * 1024 * 1024) {
                        fileSizeInfo.innerText += ' âš ï¸ ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ØŒ Ù‚Ø¯ Ù„Ø§ ÙŠØ­ÙØ¸. Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø± Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ.';
                    } else {
                        fileSizeInfo.innerText += ' âœ… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø­ÙØ¸.';
                    }

                    resultArea.classList.remove('hidden');
                    statusContainer.classList.add('hidden');
                    processBtn.disabled = false;

                } catch (err) {
                    console.error('FFmpeg error:', err);
                    alert("âŒ ÙØ´Ù„Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©. Ø¬Ø±Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø¬ÙˆØ¯Ø© Ù…Ù†Ø®ÙØ¶Ø© Ø£Ùˆ ÙÙŠØ¯ÙŠÙˆ Ø£Ù‚ØµØ±.");
                    statusContainer.classList.add('hidden');
                    processBtn.disabled = false;
                }
            };

            // Ø¯Ø§Ù„Ø© Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ù…Ø©
            function downloadBlob(blob, filename) {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… anchor
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                setTimeout(() => URL.revokeObjectURL(url), 100);
            }

            // Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
            realDownloadBtn.onclick = () => {
                if (!lastProcessedBlob) return;
                downloadBlob(lastProcessedBlob, `PUBG_EDIT.mp4`);
                setTimeout(() => {
                    alert("Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø²Ø± Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ.");
                }, 1000);
            };

            // Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ø±Ø¦ (Ø¶ØºØ· Ø¥Ø¶Ø§ÙÙŠ)
            emergencyDownloadBtn.onclick = async () => {
                if (!lastProcessedBlob) return;

                emergencyDownloadBtn.disabled = true;
                emergencyDownloadBtn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¶ØºØ·...';

                try {
                    // Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬ Ø¨Ø¶ØºØ· Ø£Ù‚ÙˆÙ‰
                    if (!ffmpeg.isLoaded()) await ffmpeg.load();

                    const inputName = 'emergency_in.mp4';
                    const outputName = 'emergency_out.mp4';
                    
                    // ØªØ­ÙˆÙŠÙ„ blob Ø¥Ù„Ù‰ Ù…Ù„Ù
                    ffmpeg.FS('writeFile', inputName, await fetchFile(new File([lastProcessedBlob], 'temp.mp4')));

                    // Ø¶ØºØ· Ø´Ø¯ÙŠØ¯
                    await ffmpeg.run(
                        '-i', inputName,
                        '-c:v', 'libx264',
                        '-crf', '42',
                        '-b:v', '500k',
                        '-preset', 'ultrafast',
                        '-vf', 'scale=-2:320', // 320p
                        '-movflags', '+faststart',
                        '-c:a', 'copy',
                        outputName
                    );

                    const data = ffmpeg.FS('readFile', outputName);
                    const compressedBlob = new Blob([data.buffer], { type: 'video/mp4' });

                    // ØªÙ†Ø¸ÙŠÙ
                    try { ffmpeg.FS('unlink', inputName); } catch(e) {}
                    try { ffmpeg.FS('unlink', outputName); } catch(e) {}

                    // ØªØ­Ù…ÙŠÙ„
                    downloadBlob(compressedBlob, `PUBG_EMERGENCY.mp4`);

                } catch (e) {
                    console.error(e);
                    alert("ÙØ´Ù„ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ø·Ø§Ø±Ø¦ØŒ Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠØ¯ÙŠÙˆ Ø£Ù‚ØµØ±.");
                } finally {
                    emergencyDownloadBtn.disabled = false;
                    emergencyDownloadBtn.innerText = 'Ø­ÙØ¸ Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ø¬ÙˆØ¯Ø© ğŸ†˜';
                }
            };
        })();
    </script>
</body>
</html>
