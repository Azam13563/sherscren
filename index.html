<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุจุซ ุจุจุฌู | ูุถุน ุงูุชุฌุงูุฒ ุงูููุงุฆู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@900&display=swap');
        body { font-family: 'Noto Sans Arabic', sans-serif; background: #000; color: #fff; height: 100vh; overflow: hidden; }
        .force-bg { background: linear-gradient(135deg, #1e40af 0%, #1e1b4b 100%); }
        #canvas-buffer { display: none; }
        .stream-status { font-size: 10px; color: #4ade80; }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-4">

    <!-- ุงุฎุชูุงุฑ ุงูุฏูุฑ -->
    <div id="selection-view" class="space-y-8 w-full max-w-sm text-center">
        <h1 class="text-4xl font-black italic">LENOVO <span class="text-blue-500">PRO</span></h1>
        <p class="text-zinc-500 text-xs">ุชู ุฅูุบุงุก ูุธุงู ุงูุฃุฐููุงุช ุงููุนุทู ูุงุณุชุฎุฏุงู ูุธุงู ุงูุจุซ ุงููุจุงุดุฑ</p>
        
        <div class="flex flex-col gap-4">
            <button onclick="setupPC()" class="bg-zinc-900 p-6 rounded-3xl border border-zinc-700 font-bold">ุงุณุชูุจุงู ุงูุจุซ (ุงูููุจููุชุฑ)</button>
            <button onclick="setupTablet()" class="bg-zinc-900 p-6 rounded-3xl border border-zinc-700 font-bold">ุจุซ ุงููุนุจุฉ (ุงููููููู)</button>
        </div>
    </div>

    <!-- ูุงุฌูุฉ ุงูุจู ุณู -->
    <div id="pc-view" class="hidden text-center space-y-6">
        <div id="qrcode" class="p-4 bg-white rounded-3xl inline-block shadow-2xl border-4 border-blue-500"></div>
        <p class="font-bold text-blue-400">ุงูุณุญ ุงูููุฏ ุจุงูุชุงุจูุช</p>
    </div>

    <!-- ูุงุฌูุฉ ุงูุชุงุจูุช (ุชุฌุงูุฒ ุงูุญูุงูุฉ) -->
    <div id="tablet-view" class="hidden w-full max-w-sm space-y-6 text-center">
        <div class="bg-blue-900/20 border border-blue-500/30 p-4 rounded-2xl text-[11px] text-blue-400">
            <b>ูุถุน ุงูุชุฌุงูุฒ ุงููุจุงุดุฑ:</b><br>
            ุฅุฐุง ูู ุชุธูุฑ ูุงูุฐุฉ ุงูุดุงุดุฉุ ุงููููุน ุณูููู ุจุจุซ "ุงููุงููุฑุง ุงูุฎูููุฉ" ููุฌูุฉ ูุดุงุดุฉ ุงููุนุจุฉ ูุญู ุจุฏููุ ุฃู ุญุงูู ุงูุถุบุท ูุฑุฉ ุฃุฎุฑู.
        </div>

        <button id="start-btn" class="w-full py-8 force-bg rounded-[2rem] font-black text-2xl shadow-xl">
            ุชูุดูุท ุงูุจุซ ุงูุขู
        </button>
        
        <div id="tablet-log" class="text-[9px] text-zinc-600 font-mono"></div>
    </div>

    <!-- ุงูุนุฑุถ ุงููุจุงุดุฑ -->
    <div id="live-view" class="hidden fixed inset-0 bg-black">
        <video id="remote-video" class="w-full h-full object-contain" autoplay playsinline></video>
        <canvas id="canvas-buffer"></canvas>
    </div>

    <script>
        let peer;
        const $ = id => document.getElementById(id);

        function setupPC() {
            $('selection-view').classList.add('hidden');
            $('pc-view').classList.remove('hidden');
            peer = new Peer();
            peer.on('open', id => {
                const url = window.location.href.split('?')[0] + "?sid=" + id;
                new QRCode($("qrcode"), { text: url, width: 220, height: 220 });
            });
            peer.on('call', call => {
                call.answer();
                call.on('stream', stream => {
                    $('pc-view').classList.add('hidden');
                    $('live-view').classList.remove('hidden');
                    $('remote-video').srcObject = stream;
                });
            });
        }

        async function setupTablet() {
            const sid = new URLSearchParams(window.location.search).get('sid');
            if (!sid) return alert("ุงูุณุญ ุงูููุฏ ุฃููุงู!");

            $('selection-view').classList.add('hidden');
            $('tablet-view').classList.remove('hidden');

            $('start-btn').onclick = async () => {
                try {
                    // ุงููุญุงููุฉ ุฑูู 1: ุทูุจ ุงูุดุงุดุฉ (ุงูุชู ุชุฑูุถูุง ูููููู)
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { frameRate: 60 },
                        audio: true
                    });

                    peer = new Peer();
                    peer.on('open', () => {
                        peer.call(sid, stream);
                        $('start-btn').innerText = "ูุชุตู โ";
                    });

                } catch (e) {
                    // ุฅุฐุง ูุดูุช (ููุฐุง ุงููุชููุน ูู ุญุงูุชู)ุ ุณูููู ุจูุชุญ "ุงููุงููุฑุง" ูุจุฏูู
                    // ูุฃู ุฃูุฏุฑููุฏ ููุงูู ุนูู ุงููุงููุฑุง ุฏุงุฆูุงู ุจุนูุณ ุงูุดุงุดุฉ
                    alert("ูุธุงู ูููููู ูุฑูุถ ุจุซ ุงูุดุงุดุฉ ุฏุงุฎููุงู. ุณุฃููู ุจุชูุนูู ุงููุงููุฑุง ูุจุฏููุ ููููู ูุถุน ุงูุชุงุจูุช ุฃูุงู ุดุงุดุฉ ุฃุฎุฑู ุฃู ูุญุงููุฉ ูุชุญ ุงูุฃุฐููุงุช ูุฏููุงู ูู ุงูููู ๐ ููู.");
                    
                    const camStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    peer = new Peer();
                    peer.on('open', () => {
                        peer.call(sid, camStream);
                    });
                }
            };
        }

        window.onload = () => {
            if (window.location.search.includes('sid')) setupTablet();
        };
    </script>
</body>
</html>
