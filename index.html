<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุฅุตูุงุญ ุจุซ ูููููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap');
        body { font-family: 'Noto Sans Arabic', sans-serif; background: #080808; color: #fff; margin: 0; height: 100vh; overflow: hidden; }
        .btn-action { background: #2563eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3); transition: 0.3s; }
        .btn-action:active { transform: scale(0.95); background: #1d4ed8; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 12px; }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-6">

    <!-- ุดุงุดุฉ ุงูุงุฎุชูุงุฑ -->
    <div id="selection-view" class="text-center space-y-6 w-full max-w-sm">
        <h1 class="text-3xl font-bold mb-8 text-blue-500">Lenovo <span class="text-white">Mirror Fix</span></h1>
        <button onclick="initPC()" class="w-full p-5 bg-zinc-900 rounded-2xl border border-zinc-800 flex items-center justify-between group">
            <span class="font-bold">ุฌูุงุฒ ุงูุนุฑุถ (ุงูุจู ุณู)</span>
            <i data-lucide="monitor" class="text-blue-500"></i>
        </button>
        <button onclick="initTablet()" class="w-full p-5 bg-zinc-900 rounded-2xl border border-zinc-800 flex items-center justify-between group">
            <span class="font-bold">ุจุซ ุงููุนุจุฉ (ุงูุชุงุจูุช)</span>
            <i data-lucide="tablet" class="text-emerald-500"></i>
        </button>
    </div>

    <!-- ูุงุฌูุฉ ุงูุจู ุณู -->
    <div id="pc-view" class="hidden text-center space-y-6">
        <div id="qrcode" class="p-4 bg-white rounded-2xl inline-block shadow-2xl"></div>
        <p class="text-zinc-400">ุงูุณุญ ุงูููุฏ ูู ุชุงุจูุช ูููููู</p>
        <div id="peer-id" class="text-blue-400 font-mono text-xs">ุฌุงุฑู ุงูุชุฌููุฒ...</div>
    </div>

    <!-- ูุงุฌูุฉ ุงูุชุงุจูุช (ุงููุฑุณู) -->
    <div id="tablet-view" class="hidden w-full max-w-sm space-y-6 text-center">
        <div class="warning-box p-4 text-xs text-red-400 text-right leading-relaxed">
            ุฅุฐุง ุถุบุทุช "ุจุฏุก" ููู ูุธูุฑ ุดูุก: <br>
            1. ุงุถุบุท ุนูู ุฃููููุฉ (ุงูููู ๐) ุจุฌุงูุจ ุฑุงุจุท ุงููููุน ููู. <br>
            2. ุงุฎุชุฑ <b>"ุฅุนุฏุงุฏุงุช ุงููููุน"</b> ูุงุถุบุท <b>"ุฅุนุงุฏุฉ ุชุนููู ุงูุฃุฐููุงุช"</b>.
        </div>

        <button id="start-btn" class="btn-action w-full py-5 font-bold text-xl flex items-center justify-center gap-3">
            <i data-lucide="play-circle"></i>
            ุจุฏุก ุจุซ ุจุจุฌู ุงูุขู
        </button>

        <p class="text-[10px] text-zinc-500 italic">ููุงุญุธุฉ: ุชุฃูุฏ ุฃูู ุชุณุชุฎุฏู ูุชุตูุญ Chrome ุงูุฃุตูู</p>
    </div>

    <!-- ุงูุนุฑุถ ุงููุจุงุดุฑ -->
    <div id="live-view" class="hidden fixed inset-0 bg-black">
        <video id="remote-video" class="w-full h-full object-contain" autoplay playsinline></video>
    </div>

    <script>
        let peer;
        const $ = id => document.getElementById(id);
        lucide.createIcons();

        function initPC() {
            $('selection-view').classList.add('hidden');
            $('pc-view').classList.remove('hidden');
            peer = new Peer();
            peer.on('open', id => {
                const url = window.location.href.split('?')[0] + "?sid=" + id;
                new QRCode($("qrcode"), { text: url, width: 220, height: 220 });
                $('peer-id').innerText = "ID: " + id;
            });
            peer.on('call', call => {
                call.answer();
                call.on('stream', stream => {
                    $('pc-view').classList.add('hidden');
                    $('live-view').classList.remove('hidden');
                    $('remote-video').srcObject = stream;
                });
            });
        }

        async function initTablet() {
            const sid = new URLSearchParams(window.location.search).get('sid');
            if (!sid) return alert("ูุฑุฌู ูุณุญ ุงูููุฏ ุฃููุงู!");

            $('selection-view').classList.add('hidden');
            $('tablet-view').classList.remove('hidden');

            $('start-btn').onclick = async () => {
                try {
                    // ูุญุงููุฉ ุทูุจ ุงูุดุงุดุฉ ุจุจุฑูุชูููู ูุชูุงูู ูุน ุฃูุฏุฑููุฏ
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { 
                            displaySurface: "monitor",
                            frameRate: { ideal: 60 }
                        },
                        audio: true
                    }).catch(err => {
                        console.error(err);
                        throw new Error("Permission Denied");
                    });

                    peer = new Peer();
                    peer.on('open', () => {
                        peer.call(sid, stream);
                        $('start-btn').innerText = "ุฌุงุฑู ุงูุจุซ...";
                        $('start-btn').style.opacity = "0.5";
                        $('start-btn').disabled = true;
                    });
                } catch (e) {
                    // ุฅุฐุง ูุดูุ ูุนุทู ุงููุณุชุฎุฏู ุงูุญู ุงูููุงุฆู
                    alert("ุงููุชุตูุญ ูููุน ุงูุทูุจ. ุงุถุบุท ุนูู ุฃููููุฉ ุงูููู ๐ ููู ุจุฌุงูุจ ุงูุฑุงุจุท ููุนู 'ุชุตููุฑ ุงูุดุงุดุฉ' ูุฏููุงู.");
                }
            };
        }

        window.onload = () => {
            if (window.location.search.includes('sid')) initTablet();
        };
    </script>
</body>
</html>
