<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุจุซ ุจุจุฌู | ูููููู ูุณุฑู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@900&display=swap');
        body { font-family: 'Noto Sans Arabic', sans-serif; background: #000; color: #fff; overflow: hidden; height: 100vh; }
        .force-btn {
            background: #ff0000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            animation: glow 1.5s infinite alternate;
        }
        @keyframes glow {
            from { transform: scale(1); box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); }
            to { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 0, 0, 0.8); }
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-6 text-center">

    <!-- ุดุงุดุฉ ุงูุงุฎุชูุงุฑ -->
    <div id="selection-view" class="space-y-12">
        <h1 class="text-5xl font-black italic tracking-tighter text-white">FORCE <span class="text-red-600">MIRROR</span></h1>
        <div class="flex flex-col gap-6 w-72 mx-auto">
            <button onclick="asPC()" class="bg-zinc-900 p-6 rounded-3xl border border-zinc-700 font-bold hover:bg-zinc-800">ุฌูุงุฒ ุงูุนุฑุถ (ุงูุจู ุณู)</button>
            <button onclick="asTablet()" class="bg-zinc-900 p-6 rounded-3xl border border-zinc-700 font-bold hover:bg-zinc-800">ุฌูุงุฒ ุงููุนุจ (ุงููููููู)</button>
        </div>
    </div>

    <!-- ูุงุฌูุฉ ุงูุจู ุณู -->
    <div id="pc-view" class="hidden space-y-8">
        <div id="qrcode" class="p-6 bg-white rounded-3xl inline-block"></div>
        <p class="text-zinc-400 font-bold">ุงูุณุญ ุงูููุฏ ุจุงูุชุงุจูุช ุงูุขู</p>
    </div>

    <!-- ูุงุฌูุฉ ุงูุชุงุจูุช (Force Mode) -->
    <div id="tablet-view" class="hidden w-full max-w-sm space-y-10">
        <div class="space-y-4">
            <h2 class="text-3xl font-black">ูุถุน ุงูุฅุฌุจุงุฑ</h2>
            <p class="text-zinc-500 text-sm">ุฅุฐุง ุถุบุทุช ููู ุชุธูุฑ ูุงูุฐุฉ "ุงูุจุฏุก ุงูุขู"ุ ูุงููุชุตูุญ ูุง ูุฒุงู ูู ูุถุน ุงูุฌูุงู. <br><b class="text-white">ุญูู ูุณุทุญ ุงูููุชุจ ููุฑุงู!</b></p>
        </div>

        <button id="force-start" class="force-btn w-full py-8 rounded-[2.5rem] font-black text-3xl uppercase tracking-widest">
            ุงุจุฏุฃ ุงูุจุซ ุงูุขู
        </button>

        <div class="flex flex-col gap-2 text-[10px] text-zinc-600">
            <span>1. ุชุฃูุฏ ุฃูู ูู Chrome</span>
            <span>2. ูุนู Desktop Site</span>
            <span>3. ูุงูู ุนูู "ุงูุจุฏุก ุงูุขู"</span>
        </div>
    </div>

    <!-- ุงูุจุซ ุงููุจุงุดุฑ (ุจู ุณู) -->
    <div id="live-view" class="hidden fixed inset-0 bg-black">
        <video id="remote-video" class="w-full h-full object-contain" autoplay playsinline></video>
    </div>

    <script>
        let peer;
        const $ = id => document.getElementById(id);
        lucide.createIcons();

        function asPC() {
            $('selection-view').classList.add('hidden');
            $('pc-view').classList.remove('hidden');
            peer = new Peer();
            peer.on('open', id => {
                const url = window.location.href.split('?')[0] + "?sid=" + id;
                new QRCode($("qrcode"), { text: url, width: 220, height: 220 });
            });
            peer.on('call', call => {
                call.answer();
                call.on('stream', stream => {
                    $('pc-view').classList.add('hidden');
                    $('live-view').classList.remove('hidden');
                    $('remote-video').srcObject = stream;
                });
            });
        }

        async function asTablet() {
            const sid = new URLSearchParams(window.location.search).get('sid');
            if (!sid) return alert("ุงูุณุญ ุงูููุฏ ุฃููุงู!");

            $('selection-view').classList.add('hidden');
            $('tablet-view').classList.remove('hidden');

            $('force-start').onclick = async () => {
                try {
                    // ูุญุงููุฉ ุฅุฌุจุงุฑูุฉ ูุงุณุชุฏุนุงุก ูุงูุฐุฉ ุชุณุฌูู ุงูุดุงุดุฉ
                    const stream = await navigator.mediaDevices.getDisplayMedia({
                        video: { 
                            cursor: "always",
                            frameRate: 60,
                            displaySurface: "monitor" 
                        },
                        audio: true
                    });

                    peer = new Peer();
                    peer.on('open', () => {
                        peer.call(sid, stream);
                        $('force-start').innerText = "ุชู ุงูุจุซ!";
                        $('force-start').style.background = "#22c55e";
                    });
                } catch (e) {
                    // ุญู ุงูุทูุงุฑุฆ: ุฅุนุงุฏุฉ ุชูุฌูู ูุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุฏุงุฎููุฉ
                    alert("ุงููุชุตูุญ ูุฑูุถ. ุงุถุบุท ุนูู ุฃููููุฉ (ุงูููู ๐) ุจุฌุงูุจ ุงูุฑุงุจุท > ุฅุนุฏุงุฏุงุช ุงููููุน > ุงูุณุญ ุงูุจูุงูุงุช ูุฃุนุฏ ุงููุญุงููุฉ.");
                }
            };
        }

        window.onload = () => {
            if (window.location.search.includes('sid')) asTablet();
        };
    </script>
</body>
</html>
